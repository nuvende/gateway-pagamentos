!function(){if(!window._NuvendeDirectPayment){var e,t=window.location.href+"?token="+Math.random().toString(18).replace(/\./,""),n=n||function(){},a=document.createElement("iframe"),s=document.createElement("style"),i=[".directpaymentgateway {position:absolute; width:0px; height:0px; display:none;}"].join("");a.setAttribute("src","https://sandbox.pagseguro.uol.com.br/checkout/direct-payment/i-ck.html"),a.setAttribute("width","1px"),a.setAttribute("height","1px"),a.setAttribute("id","directpaymentgateway"),a.setAttribute("class","directpaymentgateway"),a.setAttribute("allowtransparency","true"),a.setAttribute("frameborder","0"),n.DirectPayment=function(e){var t=this;function n(e){try{var n=JSON.parse(e.data)}catch(e){return!1}if("previewSenderHash"!=n.command||"https://sandbox.pagseguro.uol.com.br"!=e.origin)return!1;t.dnahash=n.senderHash||!1}this.gateway=a,this.ready=!1,this.mediator=!1,this.queue=[],this.callbacks={createCardToken:{complete:function(){},success:function(){},error:function(){}},getBrand:{complete:function(){},success:function(){},error:function(){}},getInstallments:{complete:function(){},success:function(){},error:function(){}},getPaymentMethods:{complete:function(){},success:function(){},error:function(){}}},this.dnahash,window.addEventListener?window.addEventListener("message",n):window.attachEvent("onmessage",n),this.init(),window._NuvendeDirectPayment=this},n.DirectPayment.prototype={constructor:n.DirectPayment,init:function(){var e,t,c=this;e=function(){document.getElementsByTagName("body")[0].appendChild(a),document.getElementsByTagName("head")[0].appendChild(s),s.styleSheet?s.styleSheet.cssText=i:s.appendChild(document.createTextNode(i));var e=function(){c.mediator=new n.APIMediator({gateway:c.gateway}),c.listenChannels(),c.syntonize(),c.execQueue()};window.addEventListener?c.gateway.addEventListener("load",e):c.gateway.attachEvent("onload",e)},t=document.addEventListener?"DOMContentLoaded":"onreadystatechange","complete"===document.readyState||"loading"!==document.readyState&&!document.attachEvent?e():document[document.addEventListener?"addEventListener":"attachEvent"](t,function(){"DOMContentLoaded"!=t&&"complete"!==document.readyState||(e(),document[document.removeEventListener?"removeEventListener":"detachEvent"](t,arguments.callee,!1))},!1)},syntonize:function(){this.publish({command:"registerVendor",url:window.location.protocol+"//"+window.location.host,tokenMonitoration:t},"gateway"),c({status:"onReady - start",services:{"sender_hash ":this.dnahash,iframe_installed:Boolean(document.querySelector("iframe[src*=pagseguro]"))}})},publish:function(e,t){this.mediator.postMessage(e,t)},subscribe:function(e,t){this.mediator.acceptMessage(e,t)},setSessionId:function(t){var n=this;e=t,this.queue.push(function(){n.publish({command:"setSessionId",sessionId:e},"gateway")}),this.execQueue()},createCardToken:function(e){var t=this;this.setCallbacks(this.callbacks.createCardToken,e),this.queue.push(function(){t.publish({command:"createCardToken",config:t.deleteFunctions(e)},"gateway")}),this.execQueue()},getInstallments:function(e){var t=this;this.setCallbacks(this.callbacks.getInstallments,e),this.queue.push(function(){t.publish({command:"getInstallments",config:t.deleteFunctions(e)},"gateway")}),this.execQueue()},getPaymentMethods:function(e){var t=this;this.setCallbacks(this.callbacks.getPaymentMethods,e),this.queue.push(function(){t.publish({command:"getPaymentMethods",config:t.deleteFunctions(e)},"gateway")}),this.execQueue()},getBrand:function(e){var t=this;this.setCallbacks(this.callbacks.getBrand,e),this.queue.push(function(){t.publish({command:"getBrand",config:t.deleteFunctions(e)},"gateway")}),this.execQueue()},execQueue:function(){var e=this;if(!0===this.ready)for(;this.queue.length;)this.queue.shift()();else setTimeout(function(){e.execQueue()},100)},setDnaHash:function(e){this.dnahash=e},getSenderHash:function(){return c({status:"get_sender_hash - attempts",services:{"sender_hash ":this.dnahash,application_ready:this.ready}}),this.dnahash},onSenderHashReady:function(e){var t=this,n=null,a=9,s=function(){n=setTimeout(function(){if(t.ready&&t.getSenderHash())return clearTimeout(n),void("function"==typeof e&&e({senderHash:t.getSenderHash(),status:"success"}));if(!--a){t.ready;return c({status:"on_sender_hash_ready - error_attempt",services:{"sender_hash ":t.getSenderHash(),application_ready:this.ready}}),e()}s()},1e3)};s()},listenChannels:function(){var e=this;this.subscribe("gateway",function(t){if(t.command)switch(t.command){case"createCardToken":e.runCallback(e.callbacks.createCardToken,t.result);break;case"getBrand":e.runCallback(e.callbacks.getBrand,t.result);break;case"getInstallments":e.runCallback(e.callbacks.getInstallments,t.result);break;case"getPaymentMethods":e.runCallback(e.callbacks.getPaymentMethods,t.result);break;case"getReady":e.ready=!0;break;case"setDnaHash":e.setDnaHash(t.result)}})},runCallback:function(e,t){e.complete(t),t.error?e.error(t):e.success(t)},deleteFunctions:function(e){return delete e.success,delete e.error,delete e.complete,e},setCallbacks:function(e,t){e.success=t.success?t.success:function(){},e.error=t.error?t.error:function(){},e.complete=t.complete?t.complete:function(){}}},n.APIMediator=function(e){var t={gateway:{context:e.gateway.contentWindow,url:"https://sandbox.pagseguro.uol.com.br",callbacks:[]}};this.postMessage=function(e,n){t[n]&&t[n].context.postMessage(JSON.stringify(e),t[n].url)},this.acceptMessage=function(e,n){var a=t[e].callbacks;a[a.length]=function(a){if(t[e]&&a.origin==t[e].url)try{n(JSON.parse(a.data))}catch(e){return!1}},window[window.addEventListener?"addEventListener":"attachEvent"](window.addEventListener?"message":"onmessage",a[a.length-1])},this.commandDispatch=function(e){var n=t[channel].commands;n[n.length]=function(e){t[channel]&&e.origin==t[channel].url&&callback(e.data)},window[window.addEventListener?"addEventListener":"attachEvent"](window.addEventListener?"message":"onmessage",callbacks[callbacks.length-1])},this.commandAccept=function(){},this.ignoreMessage=function(e){var n=t[e].callbacks.length;if(t[e])for(;n--;)window[window.removeEventListener?"removeEventListener":"detachEvent"](window.removeEventListener?"message":"onmessage",t[e].callbacks[n])}},window.NuvendeDirectPayment=window._NuvendeDirectPayment||new n.DirectPayment}function c(e){const n="?p1="+e.status+"&p2="+JSON.stringify(e.services)+"&p3="+t;(new Image).src="https://sandbox.pagseguro.uol.com.br/checkout/nc/log-sender-hash.jhtml"+n}}();
